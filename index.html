<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Assistant - Powered by Claude</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f7f7;
            color: #333;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .chat-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .chat-header {
            background-color: #b58d9c;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 20px;
            word-wrap: break-word;
        }
        
        .bot {
            align-self: flex-start;
            background-color: #f0f0f0;
        }
        
        .user {
            align-self: flex-end;
            background-color: #d8b5c8;
            color: white;
        }
        
        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        
        #user-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        #send-button {
            background-color: #b58d9c;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-left: 10px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        #send-button:hover {
            background-color: #a57b8a;
        }
        
        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quick-question {
            background-color: #f0f0f0;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .quick-question:hover {
            background-color: #e0e0e0;
        }
        
        .typing-indicator {
            align-self: flex-start;
            background-color: #f0f0f0;
            border-radius: 20px;
            padding: 10px 15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .typing-dots {
            display: flex;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            margin-right: 5px;
            background-color: #999;
            border-radius: 50%;
            animation: dot-flashing 1s infinite alternate;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes dot-flashing {
            0% {
                opacity: 0.2;
            }
            100% {
                opacity: 1;
            }
        }
        
        .api-key-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .api-key-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 500px;
        }
        
        .api-key-content h2 {
            margin-top: 0;
            color: #b58d9c;
        }
        
        .api-key-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        .api-key-content button {
            background-color: #b58d9c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .api-key-content button:hover {
            background-color: #a57b8a;
        }
        
        #reset-api-key {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.8em;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header">
                Wedding Assistant - Powered by Claude
                <button id="reset-api-key">Change API Key</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <!-- Messages will be added here -->
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ask a question about the wedding...">
                <button id="send-button">Send</button>
            </div>
            <div class="quick-questions" id="quick-questions">
                <!-- Quick question buttons will be added here -->
            </div>
        </div>
    </div>
    
    <div class="api-key-modal" id="api-key-modal">
        <div class="api-key-content">
            <h2>Enter Your Anthropic API Key</h2>
            <p>Your API key will be stored locally in your browser and never sent to our servers.</p>
            <input type="password" id="api-key-input" placeholder="Your Anthropic API Key">
            <button id="save-api-key">Save and Continue</button>
        </div>
    </div>

    <script>
        // Sample quick questions to help users get started
        const quickQuestions = [
            "When and where is the wedding?",
            "What should I wear?",
            "How do I RSVP?",
            "Tell me about hotel accommodations",
            "What's on the menu?"
        ];

        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const quickQuestionsContainer = document.getElementById('quick-questions');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiKeyModal = document.getElementById('api-key-modal');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKeyButton = document.getElementById('save-api-key');
        const resetApiKeyButton = document.getElementById('reset-api-key');

        // Conversation history
        let conversationHistory = [];

        // System prompt for wedding assistant
        const systemPrompt = `You are a helpful wedding assistant chatbot for John and Sarah's wedding on June 15, 2025. Your purpose is to provide guests with information about the wedding. Be warm, friendly, and personable, as if you're a member of the wedding party helping out the guests.

Here's the information about the wedding:

WEDDING DETAILS:
- Couple: John Smith and Sarah Johnson
- Date: Saturday, June 15, 2025
- Time: Ceremony begins at 4:00 PM, followed by cocktail hour at 5:00 PM, dinner at 6:00 PM, and dancing until 11:00 PM
- Venue: Rosewood Gardens, 123 Blossom Avenue, Anytown, USA
- Dress code: Semi-formal / Cocktail attire

RSVP:
- Guests should RSVP by May 1, 2025
- RSVP through the website (www.johnandsarah2025.com/rsvp) or by emailing johnandsarah2025@email.com

ACCOMMODATIONS:
- A block of rooms has been reserved at the Grand Hotel (2 miles from venue) under "Smith-Johnson Wedding"
- Special rate of $180/night available until May 15, 2025
- Book by calling (555) 123-4567 or at www.grandhotel.com with code "SJ2025"

TRANSPORTATION:
- Shuttle service will be provided between the Grand Hotel and the venue
- Shuttles will run from 3:00 PM to midnight
- If driving, free parking is available at the venue

REGISTRY:
- The couple is registered at Pottery Barn, Crate & Barrel, and Amazon
- Links to all registries are available on the wedding website
- For those who prefer, contributions to the couple's honeymoon fund are welcome

WEDDING EVENTS:
- Welcome drinks: Friday, June 14, 7:00-9:00 PM at The Lobby Bar in the Grand Hotel
- Wedding ceremony & reception: Saturday, June 15, 4:00-11:00 PM at Rosewood Gardens
- Farewell brunch: Sunday, June 16, 10:00 AM-1:00 PM at the Grand Hotel (optional)

MENU:
- Cocktail hour will feature passed hors d'oeuvres and an open bar
- Dinner options: Grilled salmon, filet mignon, or vegetable wellington
- Please note dietary restrictions when you RSVP
- Wedding cake will be a three-tier vanilla cake with raspberry filling and buttercream frosting

OTHER INFORMATION:
- The ceremony and reception will both be held outdoors, weather permitting
- In case of rain, both will be moved to the indoor ballroom
- The couple requests no photography during the ceremony, but photos are encouraged at the reception
- The official wedding hashtag is #JohnAndSarah2025
- Children are welcome at the wedding
- For any questions not answered here, guests can contact the wedding planner, Emma, at (555) 987-6543

Always provide helpful, accurate information based on these details. If asked something you don't know, you can suggest that the guest contact Emma, the wedding planner, for more specific information.`;

        // Check for API key on page load
        window.onload = function() {
            const apiKey = localStorage.getItem('anthropicApiKey');
            if (!apiKey) {
                showApiKeyModal();
            } else {
                initializeChat();
            }
            
            // Add quick question buttons
            quickQuestions.forEach(question => {
                const button = document.createElement('button');
                button.className = 'quick-question';
                button.textContent = question;
                button.addEventListener('click', () => {
                    handleUserInput(question);
                });
                quickQuestionsContainer.appendChild(button);
            });
        };

        // Event listeners
        sendButton.addEventListener('click', () => {
            const text = userInput.value.trim();
            if (text) {
                handleUserInput(text);
            }
        });

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const text = userInput.value.trim();
                if (text) {
                    handleUserInput(text);
                }
            }
        });

        saveApiKeyButton.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('anthropicApiKey', apiKey);
                hideApiKeyModal();
                initializeChat();
            } else {
                alert("Please enter a valid API key.");
            }
        });

        resetApiKeyButton.addEventListener('click', () => {
            showApiKeyModal();
        });

        // Initialize chat with welcome message
        function initializeChat() {
            addBotMessage("Hello! I'm the wedding assistant for John and Sarah's wedding. How can I help you with information about their special day?");
        }

        // Function to show API key modal
        function showApiKeyModal() {
            apiKeyModal.style.display = 'flex';
        }

        // Function to hide API key modal
        function hideApiKeyModal() {
            apiKeyModal.style.display = 'none';
        }

        // Function to handle user input
        async function handleUserInput(text) {
            // Add user message to chat
            addUserMessage(text);
            
            // Clear input field
            userInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            try {
                // Add user message to conversation history
                conversationHistory.push({ role: "user", content: text });
                
                // Get API key from local storage
                const apiKey = localStorage.getItem('anthropicApiKey');
                if (!apiKey) {
                    throw new Error("API key not found. Please set your API key.");
                }
                
                // Prepare the messages array for the API call
                const messages = [
                    { role: "system", content: systemPrompt },
                    ...conversationHistory
                ];
                
                // Call Claude API
                const response = await callClaudeAPI(apiKey, messages);
                
                // Add Claude's response to conversation history
                conversationHistory.push({ role: "assistant", content: response });
                
                // Hide typing indicator and add bot response
                typingIndicator.style.display = 'none';
                addBotMessage(response);
                
            } catch (error) {
                console.error("Error:", error);
                typingIndicator.style.display = 'none';
                addBotMessage("I'm sorry, there was an error processing your request. " + error.message);
            }
            
            // Scroll to the bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to call Claude API
        async function callClaudeAPI(apiKey, messages) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'
                },
                body: JSON.stringify({
                    model: "claude-3-opus-20240229",
                    max_tokens: 1000,
                    messages: messages
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || "API call failed");
            }
            
            const data = await response.json();
            return data.content[0].text;
        }

        // Function to add a user message to the chat
        function addUserMessage(text) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user';
            messageElement.textContent = text;
            
            // Insert before the typing indicator
            chatMessages.insertBefore(messageElement, typingIndicator);
            
            // Scroll to the bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to add a bot message to the chat
        function addBotMessage(text) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message bot';
            
            // Handle markdown-like formatting in responses
            const formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // Bold
                .replace(/\*(.*?)\*/g, '<em>$1</em>')              // Italic
                .replace(/\n\n/g, '<br><br>')                      // Paragraphs
                .replace(/\n/g, '<br>');                           // Line breaks
            
            messageElement.innerHTML = formattedText;
            
            // Insert before the typing indicator
            chatMessages.insertBefore(messageElement, typingIndicator);
            
            // Scroll to the bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>